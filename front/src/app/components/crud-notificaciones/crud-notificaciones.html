<p>¡Gestión de notificaciones!</p>

<button (click)="prepararCrear()" class="btn btn-success">Nueva notificación</button>

<div *ngIf="mostrarFormulario" class="mt-3">
  <form (ngSubmit)="guardar()" enctype="multipart/form-data">
    <div>
      <label>Número de documento:</label>
      <input
        type="text"
        [(ngModel)]="notificacionForm.numero_documento"
        name="numero_documento"
        required
      />
    </div>

    <div>
      <label>Tipo:</label>
      <select [(ngModel)]="notificacionForm.tipo" name="tipo" required>
        <option value="recordatorio">Recordatorio</option>
        <option value="multa">Multa</option>
        <option value="prestamo">Préstamo</option>
        <option value="mensaje_admin">Mensaje Admin</option>
      </select>
    </div>

    <div>
      <label>Contenido:</label>
      <textarea
        [(ngModel)]="notificacionForm.contenido"
        name="contenido"
        rows="3"
        required
      ></textarea>
    </div>

    <div>
      <label>Fecha de envío:</label>
      <input
        type="datetime-local"
        [(ngModel)]="notificacionForm.fecha_envio"
        name="fecha_envio"
        required
      />
    </div>

    <div>
      <label>Estado:</label>
      <select [(ngModel)]="notificacionForm.estado" name="estado" required>
        <option value="no_leida">No Leída</option>
        <option value="leida">Leída</option>
      </select>
    </div>

    <div>
      <button type="submit" class="btn btn-primary">
        {{ editando ? 'Actualizar notificación' : 'Crear notificación' }}
      </button>
      <button type="button" class="btn btn-info" (click)="cancelar()">
        Cancelar
      </button>
    </div>
  </form>
</div>

<p *ngIf="notificaciones.length === 0" class="mt-3">
  No hay notificaciones registradas
</p>

<table class="table table-bordered mt-3" *ngIf="notificaciones.length > 0">
  <thead>
    <tr>
      <th>Número de documento</th>
      <th>Tipo</th>
      <th>Contenido</th>
      <th>Fecha de envío</th>
      <th>Estado</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let notif of notificaciones">
      <td>{{ notif.numero_documento }}</td>
      <td>{{ notif.tipo }}</td>
      <td>{{ notif.contenido }}</td>
      <td>{{ notif.fecha_envio | date: 'short' }}</td>
      <td>{{ notif.estado }}</td>
      <td>
        <button class="btn btn-sm btn-warning" (click)="editar(notif)">
          Editar
        </button>
        <button class="btn btn-sm btn-danger" (click)="eliminar(notif._id!)">
          Eliminar
        </button>
      </td>
    </tr>
  </tbody>
</table>
